
1)Вход генератора импульсов должен быть подтянут к плюсу так как выход генератора импульсов представляет собой транзистор с открытым коллектором  
а) Сделать переключатели выбора (Вход генератора импульсов подтянут к минусу, к +5В и к +12В ) 
2)Зделать защиту от обратного счета генератора импульсов:
а)  Сделать 2 (два) роздельных канала для  входов импульсов.
б) Сделать алгоритм роботы:
б.1) только по первому входу
б.2) только по второму входу
б.3) сумирования импульсов 1+2 входы
б.4) Если порядок импульсов с генератора  по 2 каналам (11 10 00 01 11 10 ....) то организовать защиту от дребезгов контактов путем 
б.4.1) Подавать(пропускать) импульс сигнала только  эсли были пройдены все 4 состояния по порядку  (11 10 00 01) 
Контроллер не обращает внимания на состояния не из очереди (В обратную сторону если крутится то считает в 3 раза медленней) но при этом максимальная защита от дребезга контактов
б.4.2) потом допишу алгоритм (проще сделать на логических элементах).(Если сделать карту карно то поймете ???)   
б.5) Если порядок импульсов с генератора  по 2 каналам (11 10 11 01) то сделать как в пункте б.4.1)
  
3) Надо организовать програмную защиту от  дребезгов контактов генератора импульсов  путем ручной настройки минимально возможного времени от импульса до импульса(от 1 до 50 мс ).
То есть приходит импульс -вкл таймер на время параметра дребезга контактов. 
Если новый импульс пришел после выключения таймера то этот импульс засчитывается. Если раньше - то таймер вкл заново, а импульс не засчитывается.



Сделать выход на плате +5 вольт для всевозможных нагрузок(выход хотябы 100 мА) ... безконтактный концевик на лотке итд....  Такой чтоб не боялся К.З. и скачков напряжения(статического напряжения).
Также при его кз не выключался контроллер. 